@page
@model Chirp.Web.Pages.AboutMeModel
@{
    ViewData["Title"] = $"About {Model.AuthorName ?? Model.UserName}";
}

<div style="max-width: 700px; margin: 2rem auto; padding: 1rem;">
    <h2>About Me</h2>

    <div style="background:#f8f9fa; padding:1.5rem; border-radius:8px; margin-bottom:2rem;">
        <p><strong>Name:</strong> @(Model.AuthorName ?? "Not set")</p>
        <p><strong>Username:</strong> @Model.UserName</p>
        <p><strong>Email:</strong> 
            @if (!string.IsNullOrEmpty(Model.Email))
            {
                <a href="mailto:@Model.Email">@Model.Email</a>
            }
            else
            {
                <em>Not provided</em>
            }
        </p>
    </div>

    <h3>My Cheeps (@Model.Cheeps.Count)</h3>
    @if (Model.Cheeps.Any())
    {
        <ul id="messagelist" class="cheeps">
            @foreach (var cheep in Model.Cheeps)
            {
                <li>
                    <p>
                        <strong>
                            <a href="/@cheep.AuthorName">@cheep.AuthorName</a>

                            @if (User.Identity?.IsAuthenticated == true && 
                                User.Identity.Name is not null && 
                                User.Identity.Name != cheep.AuthorName)
                            {
                                var isFollowing = await Model.IsFollowingAsync(cheep.AuthorName);
                                if (isFollowing)
                                {
                                    <a href="?handler=Unfollow&followee=@cheep.AuthorName" class="text-danger">unfollow</a>
                                }
                                else
                                {
                                    <a href="?handler=Follow&followee=@cheep.AuthorName">follow</a>
                                }
                            }
                        </strong>
                        @cheep.Text
                        <small>â€” @cheep.TimeStamp</small>
                    </p>
                </li>
            }
        </ul>
    }
    else
    {
        <em>There are no cheeps yet.</em>
    }

    <hr style="margin:2rem 0;" />

    <h3>Following (@Model.Following.Count)</h3>
    @if (Model.Following.Any())
    {
        <ul style="list-style:none; padding:0;">
            @foreach (var name in Model.Following)
            {
                <li style="padding:0.75rem 0; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee;">
                    <div>
                        <strong><a href="/@name">@name</a></strong>
                    </div>
                    <div>
                        <form method="post" asp-page-handler="Unfollow" style="display:inline; margin:0;">
                            <input type="hidden" name="followee" value="@name" />
                            <button type="submit" 
                                    class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('Unfollow @name?');">
                                Unfollow
                            </button>
                        </form>
                    </div>
                </li>
            }
        </ul>
    }
    else
    {
        <p><em>Not following anyone yet.</em></p>
    }

    <hr style="margin:2rem 0;" />

    <p>
        <a href="/@Model.UserName" class="btn btn-primary">View My Full Timeline</a>
    </p>
</div>